Вот финальное техническое описание проекта (Project Design Document), которое можно использовать для README на GitHub, в портфолио или как план разработки.

---

# Project Name: GoldTalk (или CS-Voice)

### *Headless VoIP Messenger over GoldSrc Protocol*

### 1. Концепция (Concept)

**GoldTalk** — это экспериментальное VoIP-приложение (голосовой мессенджер), которое использует инфраструктуру игровых серверов *Counter-Strike 1.6* в качестве бэкенда для передачи аудиопотока.

Приложение не требует установки игры. Это полностью **headless-клиент** (клиент без графики), который эмулирует сетевой протокол движка GoldSrc, подключается к серверу как "игрок-зритель" (Spectator) и использует игровой голосовой канал для общения в формате конференц-связи.

### 2. Архитектура (Architecture)

Система состоит из двух частей: Легковесный Сервер (Relay) и Кастомный Клиент.

#### A. Серверная часть (Backend)

Мы не пишем сервер с нуля, мы используем готовое, проверенное десятилетиями решение.

* **Ядро:** **ReHLDS** (Reverse-engineered Half-Life Dedicated Server) — оптимизированная версия сервера CS 1.6.
* **Авторизация:** Плагин **Reunion** — позволяет подключаться клиентам без Steam ID (эмуляция Non-Steam).
* **ОС:** Linux (Ubuntu/Debian) на минимальных мощностях (1 vCPU, 256MB RAM).
* **Хостинг:** Oracle Cloud Free Tier или любой дешевый VPS.
* **Конфигурация:**
* `sv_alltalk 1` — глобальный голосовой чат (слышно всех).
* `maxplayers 32` — лимит участников конференции (можно расширить плагинами).
* `sv_voicecodec voice_speex` (или `voice_opus` с модулем ReVoice) — кодек сжатия.



#### B. Клиентская часть (App)

Приложение (Desktop/Mobile), написанное на **Python / C++ / Go**. Оно не рендерит 3D-графику, а работает только с сокетами и аудио-драйвером.

**Логика работы клиента:**

1. **Network Layer:** Реализация UDP-протокола GoldSrc.
* Отправка `C2S_CONNECT` (подключение).
* Обработка `S2C_CHALLENGE` (рукопожатие).
* Отправка `C2S_JOINGAME` (вход в мир).


2. **Game Logic Emulation:**
* Автоматический выбор команды `Spectator` (чтобы не убили и не мешать "игровому процессу", если он есть).
* Отправка `CLC_Move` (пустые пакеты движения) или `KeepAlive`, чтобы сервер не разорвал соединение по таймауту.


3. **Audio Engine:**
* **Input:** Захват звука с микрофона -> PCM -> Кодирование (Speex/Opus).
* **Transport:** Упаковка фреймов в пакеты `CLC_VoiceData`.
* **Output:** Получение пакетов `SVC_VoiceData` от сервера -> Декодирование -> Воспроизведение.



### 3. Поток данных (Data Flow)

```text
[User A Mic] 
   ⬇ 
[App Encoder (Speex)] 
   ⬇ 
[UDP Packet Wrapper (GoldSrc Proto)] 
   ⬇ 
   ------------------------ INTERNET ------------------------
   ⬇ 
[ReHLDS Server (Port 27015)] <--- (sv_alltalk 1: Relay to all)
   ⬇ 
   ------------------------ INTERNET ------------------------
   ⬇ 
[UDP Unpacker] 
   ⬇ 
[App Decoder] 
   ⬇ 
[User B Speakers]

```

### 4. Технические преимущества (Why this stack?)

1. **Невероятная дешевизна:** Сервер ReHLDS потребляет ничтожно мало ресурсов. Один бесплатный инстанс Oracle Cloud может держать "комнату" на 32 человека 24/7 бесплатно.
2. **Маскировка трафика:** Для провайдеров и фаерволов (DPI) трафик выглядит как обычная онлайн-игра. Это позволяет обходить блокировки VoIP протоколов в корпоративных сетях или странах с жесткой цензурой.
3. **Стабильность:** Протокол UDP в GoldSrc отлаживался 25 лет. Он отлично работает даже на плохом интернете (packet loss), так как игре не важна 100% целостность голосовых пакетов.

### 5. Стек технологий для разработки (Tech Stack)

* **Язык:**
* *Python* (для прототипа): Библиотеки `socket`, `pyaudio`, `struct`.
* *Go / C#* (для продакшена): Лучшая работа с многопоточностью и бинарными данными.


* **Аудио:** Библиотеки `libspeex` или `opus` (через FFI).
* **Сниффинг (для реверса):** Wireshark (анализ пакетов между реальной CS 1.6 и сервером для отладки).

### 6. Roadmap (План реализации)

1. **Phase 1: "Ping-Pong"**
* Поднять ReHLDS сервер.
* Написать скрипт, который коннектится к серверу и висит в спектрах (проходит авторизацию и не получает кик).


2. **Phase 2: "Слышу голоса"**
* Научить скрипт принимать UDP пакеты, фильтровать `SVC_VoiceData` и сохранять их в файл (или играть в колонки). Зайти с реальной CS 1.6 и говорить в микрофон для теста.


3. **Phase 3: "Говорю сам"**
* Реализовать захват микрофона, кодирование в формат CS и отправку пакетов на сервер.


4. **Phase 4: UI Wrapper**
* Обернуть код в простое приложение (список серверов, кнопка "Connect", Mute/Unmute).
